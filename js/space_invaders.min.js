!function(a,b,c){"use strict";a.requestAnimFrame=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}();var d={alphabet:{A:"28,54,99,99,127,99,99",B:"63,99,99,63,99,99,63",C:"62,99,3,3,3,99,62",D:"31,51,99,99,99,51,31",E:"127,3,3,63,3,3,127",F:"63,3,3,31,3,3,3",G:"62,99,3,115,99,99,62",H:"99,99,99,127,99,99,99",I:"30,12,12,12,12,12,30",J:"96,96,96,96,96,99,62",K:"99,51,27,15,27,51,99",L:"3,3,3,3,3,3,127",M:"99,119,127,107,99,99,99",N:"99,103,111,127,123,115,99",O:"62,99,99,99,99,99,62",P:"63,99,99,99,63,3,3",Q:"62,99,99,99,123,51,94",R:"63,99,99,63,27,51,99",S:"62,99,3,62,96,99,62",T:"63,12,12,12,12,12,12",U:"99,99,99,99,99,99,62",V:"99,99,99,99,54,28,8",W:"99,99,99,107,127,119,99",X:"99,119,62,28,62,119,99",Y:"51,51,51,30,12,12,12",Z:"127,112,56,28,14,7,127",a:"0,0,62,96,126,99,126",b:"3,3,3,63,99,99,63",c:"0,0,62,3,3,3,62",d:"96,96,96,126,99,99,126",e:"0,0,62,99,127,3,62",f:"56,12,30,12,12,12,12",g:"0,0,126,99,99,126,96,62",h:"3,3,3,63,99,99,99",i:"12,0,14,12,12,12,30",j:"24,0,28,24,24,24,24,14",k:"3,3,99,51,31,51,99",l:"14,12,12,12,12,12,30",m:"0,0,55,127,107,107,99",n:"0,0,31,51,51,51,51",o:"0,0,62,99,99,99,62",p:"0,0,63,99,99,63,3,3",q:"0,0,126,99,99,126,96,96",r:"0,0,31,51,3,3,3",s:"0,0,62,3,62,96,63",t:"12,12,30,12,12,12,56",u:"0,0,99,99,99,99,126",v:"0,0,99,99,54,28,8",w:"0,0,99,107,107,127,54",x:"0,0,99,54,28,54,99",y:"0,0,99,99,99,126,96,62",z:"0,0,127,56,28,14,127"," ":"0,0,0,0,0,0,0",1:"12,14,12,12,12,12,63",2:"62,99,112,60,6,3,127",3:"126,48,24,60,96,99,62",4:"56,60,54,51,127,48,48",5:"127,3,63,96,96,99,62",6:"62,99,3,63,99,99,62",7:"127,96,48,24,12,12,12",8:"62,99,99,62,99,99,62",9:"62,99,99,126,96,99,62",0:"62,99,99,99,99,99,62","(":"24,12,6,6,6,12,24",")":"6,12,24,24,24,12,6","{":"24,12,12,6,12,12,24","}":"6,12,12,24,12,12,6","<":"48,24,12,6,12,24,48",">":"3,6,12,24,12,6,3","'":"24,24,12,0,0,0,0",'"':"102,102,51,0,0,0,0",".":"0,0,0,0,0,12,12","!":"12,12,12,12,0,0,12","-":"0,0,0,63,0,0,0","+":"0,12,12,63,12,12,0",",":"0,0,0,0,0,12,12,6",":":"0,12,12,0,0,12,12",";":"0,12,12,0,0,12,12,6","?":"62,99,48,24,12,0,12",$:"8,62,3,62,96,63,8","%":"67,99,48,24,12,102,98","&":"28,54,28,14,123,51,110","=":"0,0,63,0,63,0,0",_:"0,0,0,0,0,0,127","^":"8,28,54,99,0,0,0","°":"60,102,102,60,0,0,0","€":"62,99,15,3,15,99,62","#":"20,20,62,20,62,20,20","*":"0,54,28,127,28,54,0","/":"64,96,48,24,12,6,2","\\":"2,6,12,24,48,96,64","[":"30,6,6,6,6,6,30","]":"60,48,48,48,48,48,60"},gutter:2,blueprint:function(a){var b,c,d,f,g,h,i=[];a=a.toUpperCase();for(f in a)for(b=this.alphabet[a[f]].split(","),h=0,g=b.length;g>h;++h)for(c=e.decodeNumber(b[h],7),i[h]||(i[h]=""),i[h]+=c,d=this.gutter;d--;)i[h]+="0";return i.join("\n")}},e={encode:function(a){var b,c,d=[],e=a.split("\n");for(b=0,c=e.length;c>b;++b)d.push(this.encodeLine(e[b]));return d.join(",")},decode:function(a,b){var c,d,e=[],f=a.split(",");for(c=0,d=f.length;d>c;++c)e.push(this.decodeNumber(f[c],b));return e.join("\n")},encodeLine:function(a){var b=0;for(var c in a)b+="1"===a[c]?Math.pow(2,c):0;return b},decodeNumber:function(a,b){var c,d,e="";for(c=b;c--;)d=Math.pow(2,c),a>=d?(a-=d,e="1"+e):e="0"+e;return e}},f=function(a){var b,c,d=this.element.getContext("2d"),e=this.blueprint.split("\n");d.fillStyle="rgba("+this.color+", 1)";for(var f=0,g=e.length;g>=f;++f){b=e[f]||"";for(var h=0,i=b.length;i>=h;++h)c=b[h],"1"===c&&(d.fillRect(Math.round(this.x+this.pixelSize*h),Math.round(this.y+this.pixelSize*f),this.pixelSize,this.pixelSize),a&&(this.boundingBox.width=Math.max(this.boundingBox.width,this.pixelSize*h+this.pixelSize)));a&&(this.boundingBox.height+=this.pixelSize)}},g=function(a){var b=this.boundingBox,c=a.boundingBox;return this.y+b.height<a.y?!1:this.y>a.y+c.height?!1:this.x+b.width<a.x?!1:this.x>a.x+c.width?!1:!0},h=function(a){for(var b,c,d,e=this.blueprint.split("\n"),f=0,g=e.length;g>=f;++f){b=e[f]||"";for(var h=0,i=b.length;i>=h;++h)if(c=b[h],"1"===c){d=this.color.split(",");for(var j=0;j<d.length;++j)d[j]=Math.round(parseInt(d[j],10)+80*Math.random()-40),d[j]=Math.min(255,d[j]),d[j]=Math.max(0,d[j]);a.push(new m(this.element,{color:d.join(","),pixelSize:this.pixelSize,x:Math.round(this.x+this.pixelSize*h),y:Math.round(this.y+this.pixelSize*f),velX:380*Math.random()-200,velY:280*-Math.random(),gravity:100,drag:.96,fade:.01+.01*Math.random()}))}}},i=function(a,b,d){d=d||{},c.extend(this,d),this.element=a,this.setText(b)};i.prototype.redraw=f,i.prototype.explode=h,i.prototype.setText=function(a){this.boundingBox={width:0,height:0},this.blueprint=d.blueprint(a.toString()),this.redraw(!0)};var j=function(a,b){b=b||{},c.extend(this,b),this.blueprint=e.decode(this.blueprint,this.base),this.element=a,this.boundingBox={width:0,height:0},this.redraw(!0)};j.prototype.redraw=f,j.prototype.isHit=g,j.prototype.explode=h;var k=function(a,d){var e=b.createElement("canvas");d=d||{},this.points=1,c.extend(this,d),e.width=this.maxWidth*this.pixelSize,e.height=this.maxHeight*this.pixelSize,this.element=a,this.boundingBox={width:0,height:0},this.redraw(!0)};k.prototype.redraw=f,k.prototype.shoot=function(a,b){return new l(this.element,{speed:a,color:"255, 255, 255",pixelSize:b,x:this.x+this.boundingBox.width/2,y:this.y+this.boundingBox.height})},k.prototype.explode=h,k.prototype.isHit=g;var l=function(a,b){this.canvas=a,this.ctx=a.getContext("2d"),c.extend(this,b),this.boundingBox={width:this.pixelSize,height:this.pixelSize}};l.prototype.update=function(a){return this.y+=this.speed*a,this.ctx.fillStyle="rgba("+this.color+", 1)",this.ctx.fillRect(Math.round(this.x),Math.round(this.y),this.pixelSize,this.pixelSize),this.y>this.canvas.height||this.y<-this.pixelSize?!1:!0},l.prototype.isHit=g,l.prototype.explode=function(a){for(var b,c=this.pixelSize;c--;)for(var d=this.pixelSize;d--;){b=[255,255,255];for(var e=3;e--;)b[e]=Math.round(255,25*-Math.random());a.push(new m(this.canvas,{color:b.join(","),pixelSize:this.pixelSize,x:Math.round(this.x+c),y:Math.round(this.y+d),velX:380*Math.random()-200,velY:280*-Math.random(),gravity:100,drag:.95,fade:.01+.01*Math.random()}))}};var m=function(a,b){var c=a.getContext("2d");this.size=b.pixelSize,this.boundingBox={width:this.size,height:this.size},this.alpha=1,this.update=function(a){return b.velY=b.velY*b.drag,b.velX=b.velX*b.drag,b.y+=(b.velY+b.gravity)*a,b.x+=b.velX*a,this.alpha-=b.fade||0,this.size*=b.shrink||1,c.fillStyle="rgba("+b.color+", "+this.alpha+")",c.fillRect(Math.round(b.x),Math.round(b.y),this.size,this.size),this.alpha>=.01}},n=function(b,d){function f(){A=new i(b,N,{color:"205,212,75",pixelSize:2,x:b.width-50,y:5}),A.x=b.width-A.boundingBox.width-5,ib.push(A)}function g(){var f,g,h=["255,151,94","255,182,240","195,255,232","182,255,252","197,255,182","255,242,117"],i=0,l=0,m=0;c.each(d.invaders,function(a,c){if(f=[],!(++m>P+2)){g=h[Math.floor(Math.random()*h.length)];for(var j=0;j<d.numPerRow;++j)l=cb+j*(d.gutter+I*d.pixelSize),f.push(new k(b,{blueprint:e.decode(c,d.invaderBase),color:g,pixelSize:d.pixelSize,x:l,y:d.offset+i*I*d.pixelSize})),bb=Math.max(l,bb),++Q;J.push(f),++i}}),H||(H=new j(b,{blueprint:"32,112,1022,2047,2047,2047",base:11,color:"255,82,75",pixelSize:d.pixelSize,x:b.width/2,y:b.height-30}),c(a).on("keydown keyup",n)),P>5&&(db+=eb,S+=T)}function h(){c(a).off("keydown keyup",n),hb=!0}function m(a){var b=c.inArray(a,ib);b>-1&&ib.splice(b,1)}function n(a){if(H){var c,e="keydown"===a.type,f=a.which;37===f||65===f?H.left=e:39===f||68===f?H.right=e:80===f&&e?(fb=!fb,fb?(_=new Date,z(),D.explode(M),m(D)):D=s("PAUSE")):32===f&&e&&(c=new Date,c-W>V&&(K.push(new l(b,{speed:-X,color:"255, 255, 255",pixelSize:d.bulletSize,x:H.x+H.boundingBox.width/2,y:H.y})),W=c),gb||a.preventDefault()),F&&F.focus()}}function o(a){for(var b=J.length;b--;)for(var c=J[b].length;c--;)a(J[b][c])===!1&&(J[b].splice(c,1),J[b].length||J.splice(b,1))}function p(){var a=Math.floor(Math.random()*J.length);return J[a][Math.floor(Math.random()*J[a].length)]}function q(){var a=s("GAME OVER");gb=!0,setTimeout(function(){a.explode(M);var b=c.inArray(a,ib);b>-1&&ib.splice(b,1),gb=!0,r()},3e3)}function r(){var a=s("Enter your name:");t(function(){a.explode(M),m(a),E.explode(M),m(E),v(F.val())})}function s(a){var c=new i(b,a,{color:"205,212,75",pixelSize:2});return c.x=(b.width-c.boundingBox.width)/2,c.y=(b.height-c.boundingBox.height)/2,ib.push(c),c}function t(a){F=c('<input type="text" style="position:absolute;left:-9999px" id="playerName">'),c("body").append(F),F.focus().on("keyup",function(b){u(F.val()),13===b.which&&(F.off("keyup").remove(),a())})}function u(a){return E?(E.x=(b.width-E.boundingBox.width)/2,E.setText(a)):(E=new i(b,a,{color:"205,212,75",pixelSize:2}),E.x=(b.width-E.boundingBox.width)/2,E.y=(b.height-E.boundingBox.height)/2+20,ib.push(E)),E}function v(a){G=new jaz.Highscore("space_invaders","http://localhost:8181"),a&&G.set(a,N),setTimeout(w,50)}function w(){G.getHighest(x)}function x(a){function d(a,c){var d=new i(b,a,{color:"205,212,75",pixelSize:2,y:c});d.x=(b.width-d.boundingBox.width)/2,ib.push(d)}d("HIGHSCORE",20),c.each(a,function(a,b){var c=9>a?"0":"";c+=a+1+".  ",c+=(b.player+"            ").slice(0,12)+" ",c+=("     "+b.score).slice(-6),d(c,25*a+120)})}function y(a){N+=a,A.setText(N),A.x=b.width-A.boundingBox.width-5}function z(){if(!hb){ab.clearRect(0,0,b.width,b.height);var c,f,h=new Date,i=(h-_)/1e3,j=!1;if(i=Math.min(50,i),i>100)return _=h,void(fb&&a.requestAnimFrame(z));for(H&&(H.right?(H.x+=U*i,H.x=Math.min(H.x,b.width-cb-H.boundingBox.width)):H.left&&(H.x-=U*i,H.x=Math.max(H.x,cb)),H.redraw()),o(function(a){a.x+=(R?1:-1)*S*i,a.redraw(),(R&&a.x+a.boundingBox.width>b.width-cb||!R&&a.x<cb)&&(j=!0)}),j&&(H&&o(function(a){a.y+=d.invaderVelY}),R=!R),c=K.length;c--;)K[c].update(i)||(K.splice(c,1),++O);for(c=L.length;c--;)L[c].update(i)||L.splice(c,1);for(c=M.length;c--;)M[c].update(i)||M.splice(c,1);for(o(function(a){var b,c=!0;for(b=K.length;b--;)c&&a.isHit(K[b])&&(y(a.points),a.explode(M),c=!1,K.splice(b,1),--Q);return H&&H.isHit(a)&&(H.explode(M),H=null),c}),c=L.length;c--;)for(f=K.length;f--;)L[c]&&L[c].isHit(K[f])&&(K.splice(f,1),L[c].explode(M),L.splice(c,1));for(c=L.length;c--;)H&&H.isHit(L[c])&&(H.explode(M),H=null,L.splice(c,1));if(H&&Q&&Math.random()<db&&L.push(p().shoot(Y,d.bulletSize)),Q||M.length||(++P,g()),gb||H||M.length||K.length||q(),B){for(B.x+=(C?1:-1)*d.mothership.speed*i,B.redraw(),c=K.length;c--;)B.isHit(K[c])&&(y(B.points),B.explode(M),B=null,K.splice(c,1),$=h);B&&(B.x>b.width+B.boundingBox.width||B.x<-B.boundingBox.width)&&(B=null)}else(P>=Z||gb)&&$<h-1e3*d.mothership.minTime&&Math.random()<d.mothership.probability&&(C=Math.random()<.5,B=new k(b,{blueprint:e.decode(d.mothership.blueprint,d.mothership.base),color:d.mothership.color,pixelSize:d.pixelSize,x:b.width,y:6,points:10}),B.x=C?-B.boundingBox.width:b.width,++Z);for(c=ib.length;c--;)ib[c].redraw();_=h,fb&&a.requestAnimFrame(z)}}var A,B,C,D,E,F,G,H,I=12,J=(a.DeviceOrientationEvent,[]),K=[],L=[],M=[],N=0,O=0,P=1,Q=0,R=!0,S=40,T=20,U=130,V=500,W=0,X=100,Y=100,Z=0,$=new Date,_=new Date,ab=b.getContext("2d"),bb=0,cb=d.gutter,db=.075,eb=.05,fb=!0,gb=!1,hb=!1,ib=[];return f(),g(),z(),{stop:h}};a.SpaceInvaders=function(a){var c="string"==typeof a?b.getElementById(a):a;return c.width=500,c.height=400,new n(c,{pixelSize:3,bulletSize:3,numPerRow:6,invaders:{"#invader8":"260,136,508,886,2047,1533,1285,216,","#invader2":"240,1020,4095,3687,4095,4095,360,660,1122,0","#invader3":"144,2553,2925,3069,4095,240,504,612,1026","#invader6":"240,2046,4095,3687,4095,504,876,3075","#invader1":"264,144,1020,1020,3951,3069,3069,144,264,0","#invader7":"260,1161,1533,1911,1022,1022,260,514"},invaderVelY:10,invaderBase:12,gutter:20,offset:60,mothership:{blueprint:"48,252,1023,819,510",base:10,color:"232,36,16",offset:10,minTime:15,probability:.004,speed:60,points:20}})},a.SpaceInvaders.Game=n,a.SpaceInvaders.Invader=k}(window,document,jQuery),function(a,b){"use strict";function c(b,c,d){var e,f=null,g=10;a.each(d,function(a,b){"string"==typeof b?f=b:"number"==typeof b?g=b:"function"==typeof b&&(e=b)}),a.getJSON(b+"?callback=?",{reverse:c},function(a){e(a.items)})}b.jaz=b.jaz||{},b.jaz.Highscore=function(a,b){this.gameId=a,this.url=b+"/"+this.gameId},b.jaz.Highscore.VERSION="0.0.1",b.jaz.Highscore.prototype={getHighest:function(){c(this.url,!1,arguments)},getLowest:function(){c(this.url,!0,arguments)},set:function(b,c,d){a.ajax({url:this.url,data:{player:b,score:c,scope:d},dataType:"json",type:"POST",crossDomain:!0})}}}(jQuery,window);